!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).exprEval={})}(this,(function(t){"use strict";var e="INUMBER",r="IOP1",s="IOP2",n="IOP3",i="IVAR",o="IVARNAME",a="IFUNCALL",p="IFUNDEF",h="IEXPR",u="IEXPREVAL",c="IMEMBER",f="IENDSTATEMENT",l="IARRAY";function v(t,e){this.type=t,this.value=null!=e?e:0}function y(t){return new v(r,t)}function x(t){return new v(s,t)}function w(t){return new v(n,t)}function d(t,a,p,u,f){for(var y,x,w,g,m=[],M=[],E=0;E<t.length;E++){var A=t[E],b=A.type;if(b===e||b===o)Array.isArray(A.value)?m.push.apply(m,d(A.value.map((function(t){return new v(e,t)})).concat(new v(l,A.value.length)),a,p,u,f)):m.push(A);else if(b===i&&f.hasOwnProperty(A.value))A=new v(e,f[A.value]),m.push(A);else if(b===s&&m.length>1)x=m.pop(),y=m.pop(),g=p[A.value],A=new v(e,g(y.value,x.value)),m.push(A);else if(b===n&&m.length>2)w=m.pop(),x=m.pop(),y=m.pop(),"?"===A.value?m.push(y.value?x.value:w.value):(g=u[A.value],A=new v(e,g(y.value,x.value,w.value)),m.push(A));else if(b===r&&m.length>0)y=m.pop(),g=a[A.value],A=new v(e,g(y.value)),m.push(A);else if(b===h){for(;m.length>0;)M.push(m.shift());M.push(new v(h,d(A.value,a,p,u,f)))}else if(b===c&&m.length>0)y=m.pop(),m.push(new v(e,y.value[A.value]));else{for(;m.length>0;)M.push(m.shift());M.push(A)}}for(;m.length>0;)M.push(m.shift());return M}function g(t,e,o){for(var a=[],p=0;p<t.length;p++){var u=t[p],c=u.type;if(c===i&&u.value===e)for(var f=0;f<o.tokens.length;f++){var l,d=o.tokens[f];l=d.type===r?y(d.value):d.type===s?x(d.value):d.type===n?w(d.value):new v(d.type,d.value),a.push(l)}else c===h?a.push(new v(h,g(u.value,e,o))):a.push(u)}return a}async function m(t,v,y){var x,w,d,g,b,k,O=[];if(E(t))return A(t,y);for(var T=t.length,C=0;C<T;C++){var N=t[C],S=N.type;if(S===e||S===o)O.push(N.value);else if(S===s)w=O.pop(),x=O.pop(),"and"===N.value?O.push(!!x&&!!await m(w,v,y)):"or"===N.value?O.push(!!x||!!await m(w,v,y)):"="===N.value?(g=v.binaryOps[N.value],O.push(g(x,await m(w,v,y),y))):(g=v.binaryOps[N.value],O.push(g(await A(x,y),await A(w,y))));else if(S===n)d=O.pop(),w=O.pop(),x=O.pop(),"?"===N.value?O.push(await m(x?w:d,v,y)):(g=v.ternaryOps[N.value],O.push(g(await A(x,y),await A(w,y),await A(d,y))));else if(S===i)if(N.value in v.functions)O.push(v.functions[N.value]);else if(N.value in v.unaryOps&&v.parser.isOperatorEnabled(N.value))O.push(v.unaryOps[N.value]);else{var I=y[N.value];if(void 0===I)throw new Error("undefined variable: "+N.value);O.push(I)}else if(S===r)x=O.pop(),g=v.unaryOps[N.value],O.push(g(A(x,y)));else if(S===a){for(k=N.value,b=[];k-- >0;)b.unshift(A(O.pop(),y));if(!(g=O.pop()).apply||!g.call)throw new Error(g+" is not a function");O.push(await g.apply(void 0,b))}else if(S===p)O.push(function(){for(var t=O.pop(),e=[],r=N.value;r-- >0;)e.unshift(O.pop());var s=O.pop(),n=function(){for(var r=Object.assign({},y),s=0,n=e.length;s<n;s++)r[e[s]]=arguments[s];return m(t,v,r)};return Object.defineProperty(n,"name",{value:s,writable:!1}),y[s]=n,n}());else if(S===h)O.push(M(N,v));else if(S===u)O.push(N);else if(S===c)x=O.pop(),O.push(x[N.value]);else if(S===f)O.pop();else{if(S!==l)throw new Error("invalid Expression");for(k=N.value,b=[];k-- >0;)b.unshift(O.pop());O.push(b)}}if(O.length>1)throw new Error("invalid Expression (parity)");return 0===O[0]?0:A(O[0],y)}function M(t,e,r){return E(t)?t:{type:u,value:async function(r){return m(t.value,e,r)}}}function E(t){return t&&t.type===u}function A(t,e){return E(t)?t.value(e):t}function b(t,u){for(var v,y,x,w,d,g,m=[],M=0;M<t.length;M++){var E=t[M],A=E.type;if(A===e)"number"==typeof E.value&&E.value<0?m.push("("+E.value+")"):Array.isArray(E.value)?m.push("["+E.value.map(k).join(", ")+"]"):m.push(k(E.value));else if(A===s)y=m.pop(),v=m.pop(),w=E.value,u?"^"===w?m.push("Math.pow("+v+", "+y+")"):"and"===w?m.push("(!!"+v+" && !!"+y+")"):"or"===w?m.push("(!!"+v+" || !!"+y+")"):"||"===w?m.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+v+"),("+y+")))"):"=="===w?m.push("("+v+" === "+y+")"):"!="===w?m.push("("+v+" !== "+y+")"):"["===w?m.push(v+"[("+y+") | 0]"):m.push("("+v+" "+w+" "+y+")"):"["===w?m.push(v+"["+y+"]"):m.push("("+v+" "+w+" "+y+")");else if(A===n){if(x=m.pop(),y=m.pop(),v=m.pop(),"?"!==(w=E.value))throw new Error("invalid Expression");m.push("("+v+" ? "+y+" : "+x+")")}else if(A===i||A===o)m.push(E.value);else if(A===r)v=m.pop(),"-"===(w=E.value)||"+"===w?m.push("("+w+v+")"):u?"not"===w?m.push("(!"+v+")"):"!"===w?m.push("fac("+v+")"):m.push(w+"("+v+")"):"!"===w?m.push("("+v+"!)"):m.push("("+w+" "+v+")");else if(A===a){for(g=E.value,d=[];g-- >0;)d.unshift(m.pop());w=m.pop(),m.push(w+"("+d.join(", ")+")")}else if(A===p){for(y=m.pop(),g=E.value,d=[];g-- >0;)d.unshift(m.pop());v=m.pop(),u?m.push("("+v+" = function("+d.join(", ")+") { return "+y+" })"):m.push("("+v+"("+d.join(", ")+") = "+y+")")}else if(A===c)v=m.pop(),m.push(v+"."+E.value);else if(A===l){for(g=E.value,d=[];g-- >0;)d.unshift(m.pop());m.push("["+d.join(", ")+"]")}else if(A===h)m.push("("+b(E.value,u)+")");else if(A!==f)throw new Error("invalid Expression")}return m.length>1&&(m=u?[m.join(",")]:[m.join(";")]),String(m[0])}function k(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function O(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function T(t,e,r){for(var s=!!(r=r||{}).withMembers,n=null,a=0;a<t.length;a++){var p=t[a];p.type===i||p.type===o?s||O(e,p.value)?null!==n?(O(e,n)||e.push(n),n=p.value):n=p.value:e.push(p.value):p.type===c&&s&&null!==n?n+="."+p.value:p.type===h?T(p.value,e,r):null!==n&&(O(e,n)||e.push(n),n=null)}null===n||O(e,n)||e.push(n)}function C(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}v.prototype.toString=function(){switch(this.type){case e:case r:case s:case n:case i:case o:case f:return this.value;case a:return"CALL "+this.value;case p:return"DEF "+this.value;case l:return"ARRAY "+this.value;case c:return"."+this.value;default:return"Invalid Instruction"}},C.prototype.simplify=function(t){return t=t||{},new C(d(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},C.prototype.substitute=function(t,e){return e instanceof C||(e=this.parser.parse(String(e))),new C(g(this.tokens,t,e),this.parser)},C.prototype.evaluate=function(t){return t=t||{},m(this.tokens,this,t)},C.prototype.toString=function(){return b(this.tokens,!1)},C.prototype.symbols=function(t){t=t||{};var e=[];return T(this.tokens,e,t),e},C.prototype.variables=function(t){t=t||{};var e=[];T(this.tokens,e,t);var r=this.functions;return e.filter((function(t){return!(t in r)}))},C.prototype.toJSFunction=function(t,e){var r=this,s=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+b(this.simplify(e).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var N="TEOF",S="TOP",I="TNUMBER",P="TSTRING",F="TPAREN",R="TBRACKET",L="TCOMMA",j="TNAME",U="TSEMICOLON";function q(t,e,r){this.type=t,this.value=e,this.index=r}function B(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}q.prototype.toString=function(){return this.type+": "+this.value},B.prototype.newToken=function(t,e,r){return new q(t,e,null!=r?r:this.pos)},B.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},B.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},B.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(N,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},B.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var s=this.expression.indexOf(r,e+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,"\\"!==this.expression.charAt(s-1)){var n=this.expression.substring(e+1,s);this.current=this.newToken(P,this.unescape(n),e),t=!0;break}s=this.expression.indexOf(r,s+1)}return t},B.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(F,t),this.pos++,!0)},B.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("["))&&(this.current=this.newToken(R,t),this.pos++,!0)},B.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(L,","),this.pos++,!0)},B.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken(U,";"),this.pos++,!0)},B.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(s in this.consts)return this.current=this.newToken(I,this.consts[s]),this.pos+=s.length,!0}return!1},B.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(S,s),this.pos+=s.length,!0}return!1},B.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()){if(e===this.pos&&("$"===s||"_"===s)){"_"===s&&(r=!0);continue}if(e===this.pos||!r||"_"!==s&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(t,e);return this.current=this.newToken(j,n),this.pos+=n.length,!0}return!1},B.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var V=/^[0-9a-f]{4}$/i;function _(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}B.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var s=t.charAt(++e);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var n=t.substring(e+1,e+5);V.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++e;var i=t.indexOf("\\",e);r+=t.substring(e,i<0?t.length:i),e=i}return r},B.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},B.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if(++r,"x"===this.expression.charAt(r))t=16,e=/^[0-9a-f]$/i,++r;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i,++r}for(var s=!1,n=r;r<this.expression.length;){var i=this.expression.charAt(r);if(!e.test(i))break;r++,s=!0}return s&&(this.current=this.newToken(I,parseInt(this.expression.substring(n,r),t)),this.pos=r),s},B.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,s=r,n=r,i=!1,o=!1;r<this.expression.length&&((t=this.expression.charAt(r))>="0"&&t<="9"||!i&&"."===t);)"."===t?i=!0:o=!0,r++,e=o;if(e&&(n=r),"e"===t||"E"===t){r++;for(var a=!0,p=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;p=!0,a=!1}else a=!1;r++}p||(r=n)}return e?(this.current=this.newToken(I,parseFloat(this.expression.substring(s,r))),this.pos=r):this.pos=n,e},B.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(S,e);else if("∙"===e||"•"===e)this.current=this.newToken(S,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(S,">="),this.pos++):this.current=this.newToken(S,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(S,"<="),this.pos++):this.current=this.newToken(S,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(S,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(S,"=="),this.pos++):this.current=this.newToken(S,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(S,"!="),this.pos++):this.current=this.newToken(S,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},B.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},B.prototype.getCoordinates=function(){var t,e=0,r=-1;do{e++,t=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:e,column:t}},B.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},_.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},_.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?O(e,t.value):"function"==typeof e?e(t):t.value===e)},_.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},_.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},_.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},_.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}},_.prototype.parseAtom=function(t){var r=this.tokens.unaryOps;if(this.accept(j)||this.accept(S,(function(t){return t.value in r})))t.push(new v(i,this.current.value));else if(this.accept(I))t.push(new v(e,this.current.value));else if(this.accept(P))t.push(new v(e,this.current.value));else if(this.accept(F,"("))this.parseExpression(t),this.expect(F,")");else{if(!this.accept(R,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(R,"]"))t.push(new v(l,0));else{var s=this.parseArrayList(t);t.push(new v(l,s))}}},_.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},_.prototype.pushExpression=function(t,e){for(var r=0,s=e.length;r<s;r++)t.push(e[r])},_.prototype.parseUntilEndStatement=function(t,e){return!!this.accept(U)&&(!this.nextToken||this.nextToken.type===N||this.nextToken.type===F&&")"===this.nextToken.value||e.push(new v(f)),this.nextToken.type!==N&&this.parseExpression(e),t.push(new v(h,e)),!0)},_.prototype.parseArrayList=function(t){for(var e=0;!this.accept(R,"]");)for(this.parseExpression(t),++e;this.accept(L);)this.parseExpression(t),++e;return e},_.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(S,"=");){var e=t.pop(),r=[],s=t.length-1;if(e.type!==a){if(e.type!==i&&e.type!==c)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new v(o,e.value)),t.push(new v(h,r)),t.push(x("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,u=e.value+1;n<u;n++){var f=s-n;t[f].type===i&&(t[f]=new v(o,t[f].value))}this.parseVariableAssignmentExpression(r),t.push(new v(h,r)),t.push(new v(p,e.value))}}},_.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(S,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(S,":"),this.parseConditionalExpression(r),t.push(new v(h,e)),t.push(new v(h,r)),t.push(w("?"))}},_.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(S,"or");){var e=[];this.parseAndExpression(e),t.push(new v(h,e)),t.push(x("or"))}},_.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(S,"and");){var e=[];this.parseComparison(e),t.push(new v(h,e)),t.push(x("and"))}};var $=["==","!=","<","<=",">=",">","in"];_.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(S,$);){var e=this.current;this.parseAddSub(t),t.push(x(e.value))}};var D=["+","-","||"];_.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(S,D);){var e=this.current;this.parseTerm(t),t.push(x(e.value))}};var G=["*","/","%"];function J(t,e){return Number(t)+Number(e)}function W(t,e){return t-e}function X(t,e){return t*e}function Y(t,e){return t/e}function K(t,e){return t%e}function z(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function H(t,e){return t===e}function Q(t,e){return t!==e}function Z(t,e){return t>e}function tt(t,e){return t<e}function et(t,e){return t>=e}function rt(t,e){return t<=e}function st(t,e){return Boolean(t&&e)}function nt(t,e){return Boolean(t||e)}function it(t,e){return O(e,t)}function ot(t){return(Math.exp(t)-Math.exp(-t))/2}function at(t){return(Math.exp(t)+Math.exp(-t))/2}function pt(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function ht(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function ut(t){return Math.log(t+Math.sqrt(t*t-1))}function ct(t){return Math.log((1+t)/(1-t))/2}function ft(t){return Math.log(t)*Math.LOG10E}function lt(t){return-t}function vt(t){return!t}function yt(t){return t<0?Math.ceil(t):Math.floor(t)}function xt(t){return Math.random()*(t||1)}function wt(t){return gt(t+1)}_.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(S,G);){var e=this.current;this.parseFactor(t),t.push(x(e.value))}},_.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(S,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===F&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if(this.nextToken.type===U||this.nextToken.type===L||this.nextToken.type===N||this.nextToken.type===F&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(y(r.value))}else this.parseExponential(t)},_.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(S,"^");)this.parseFactor(t),t.push(x("^"))},_.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(S,"!");)t.push(y("!"))},_.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(S,(function(t){return t.value in e}))){var r=this.current;this.parseAtom(t),t.push(y(r.value))}else for(this.parseMemberExpression(t);this.accept(F,"(");)if(this.accept(F,")"))t.push(new v(a,0));else{var s=this.parseArgumentList(t);t.push(new v(a,s))}},_.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(F,")");)for(this.parseExpression(t),++e;this.accept(L);)this.parseExpression(t),++e;return e},_.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(S,".")||this.accept(R,"[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(j),t.push(new v(c,this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(R,"]"),t.push(x("["))}}};var dt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function gt(t){var e,r;if(function(t){return isFinite(t)&&t===Math.round(t)}(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var s=t-2,n=t-1;s>1;)n*=s,s--;return 0===n&&(n=1),n}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*gt(1-t));if(t>=171.35)return 1/0;if(t>85){var i=t*t,o=i*t,a=o*t,p=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*i)-139/(51840*o)-571/(2488320*a)+163879/(209018880*p)+5246819/(75246796800*p*t))}--t,r=dt[0];for(var h=1;h<dt.length;++h)r+=dt[h]/(t+h);return e=t+4.7421875+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function mt(t){return Array.isArray(t)?t.length:String(t).length}function Mt(){for(var t=0,e=0,r=0;r<arguments.length;r++){var s,n=Math.abs(arguments[r]);e<n?(t=t*(s=e/n)*s+1,e=n):t+=n>0?(s=n/e)*s:n}return e===1/0?1/0:e*Math.sqrt(t)}function Et(t,e,r){return t?e:r}function At(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function bt(t,e,r){return r&&(r[t]=e),e}function kt(t,e){return t[0|e]}function Ot(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function Tt(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function Ct(t,e){return Promise.all(function(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,r){return t(e,r)}))}(t,e))}function Nt(t,e,r){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce((function(e,r,s){return t(e,r,s)}),e)}async function St(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");const r=e.map(((e,r)=>t(e,r))),s=await Promise.all(r);return e.filter((function(t,e){return s[e]}))}function It(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function Pt(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function Ft(t){return(t>0)-(t<0)||+t}var Rt=1/3;function Lt(t){return t<0?-Math.pow(-t,Rt):Math.pow(t,Rt)}function jt(t){return Math.exp(t)-1}function Ut(t){return Math.log(1+t)}function qt(t){return Math.log(t)/Math.LN2}function Bt(t){if(!Array.isArray(t))throw new Error("Sum argument is not an array");return t.reduce((function(t,e){return t+Number(e)}),0)}function Vt(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||ot,cosh:Math.cosh||at,tanh:Math.tanh||pt,asinh:Math.asinh||ht,acosh:Math.acosh||ut,atanh:Math.atanh||ct,sqrt:Math.sqrt,cbrt:Math.cbrt||Lt,log:Math.log,log2:Math.log2||qt,ln:Math.log,lg:Math.log10||ft,log10:Math.log10||ft,expm1:Math.expm1||jt,log1p:Math.log1p||Ut,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||yt,"-":lt,"+":Number,exp:Math.exp,not:vt,length:mt,"!":wt,sign:Math.sign||Ft},this.binaryOps={"+":J,"-":W,"*":X,"/":Y,"%":K,"^":Math.pow,"||":z,"==":H,"!=":Q,">":Z,"<":tt,">=":et,"<=":rt,and:st,or:nt,in:it,"=":bt,"[":kt},this.ternaryOps={"?":Et},this.functions={random:xt,fac:wt,min:Tt,max:Ot,hypot:Math.hypot||Mt,pyt:Math.hypot||Mt,pow:Math.pow,atan2:Math.atan2,if:Et,gamma:gt,roundTo:At,map:Ct,fold:Nt,filter:St,indexOf:It,join:Pt,sum:Bt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Vt.prototype.parse=function(t){var e=[],r=new _(this,new B(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect(N,"EOF"),new C(e,this)},Vt.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var _t=new Vt;Vt.parse=function(t){return _t.parse(t)},Vt.evaluate=function(t,e){return _t.parse(t).evaluate(e)};var $t={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};Vt.prototype.isOperatorEnabled=function(t){var e=function(t){return $t.hasOwnProperty(t)?$t[t]:t}(t),r=this.options.operators||{};return!(e in r)||!!r[e]};
/*!
   Based on ndef.parser, by Raphael Graf(r@undefined.ch)
   http://www.undefined.ch/mparser/index.html

   Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

   You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
   to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
   but don't feel like you have to let me know or ask permission.
  */
var Dt={Parser:Vt,Expression:C};t.Expression=C,t.Parser=Vt,t.default=Dt,Object.defineProperty(t,"__esModule",{value:!0})}));
